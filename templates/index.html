{% extends "base.html" %} {% block content %}

    <canvas id="myCanvas" width="200" height="200"></canvas>
    <div class="center-justified flex">
        <form id="form" method="get">
            <input type="file" name="file" multiple/>
            <button type="submit" class="btn btn-primary">Upload</button>
            <progress id="progress" value="0" max="100"></progress>
        </form>
    </div>

<script type="text/javascript">
window.onload = function() {
  const mainForm = document.getElementById("form");

  mainForm.addEventListener("submit", function(event) {
    event.preventDefault();

    const formData = new FormData(mainForm);

    const fileInput = document.querySelector('input[type="file"]');
    const files = fileInput.files;

    for (let i = 0; i < files.length; i++) {
      const file = files[i];
      if (!formData.getAll('file').includes(file)) {
        formData.append("file", file);
      }
    }

    fetch("/process", {
      method: "POST",
      body: formData,
    })
      .then((response) => {
        if (response.ok) {
          return response.json();
        } else {
          throw new Error("Error uploading file");
        }
      })
      .then((data) => {
        // Handle the response data here
        const tableBody = document.querySelector("#data tbody");
        tableBody.innerHTML = data.update_table;

        // Reset file input value
        fileInput.value = "";
      })
      .catch((error) => {
        console.error(error);
      });
  });
};

</script>


    <!-- table -->
    <div class="flex justify-center m-28">
        <table id="data" class="table-auto">
            <thead>
            <tr>
                <th>File name</th>
                <th>Date uploaded</th>
            </tr>
            </thead>
            <tbody>
            {% for entry in uploads %}
                <tr>
                    <td>{{ entry.name }}</td>
                    <td>{{ entry.time }}</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>

{% endblock %}
